<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Управление студентами</title>
    <!-- Подключаем jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Наш собственный скрипт -->
    <script defer src="app.js"></script>
</head>
<body>
<h1>Управление студентами</h1>
<div id="add-student-form">
    <form>
        <label for="first-name">Имя:</label><br>
        <input type="text" id="first-name"><br>

        <label for="last-name">Фамилия:</label><br>
        <input type="text" id="last-name"><br>

        <label for="middle-name">Отчество:</label><br>
        <input type="text" id="middle-name"><br>

        <label for="birth-date">Дата рождения:</label><br>
        <input type="date" id="birth-date"><br>

        <label for="group-number">Группа:</label><br>
        <input type="number" id="group-number"><br>

        <label for="unique-number">Уникальный номер:</label><br>
        <input type="number" id="unique-number"><br><br>

        <button type="submit">Добавить студента</button>
    </form>
</div>

<div id="students-list">
    <h2>Список студентов</h2>
    <ul></ul>
</div>

<script>
$(document).ready(function () {
    loadStudents();
});

function loadStudents() {
    $.getJSON('/api/students', function (data) {
        $('#students-list ul').empty();
        data.forEach(function (student) {
            let li = $('<li>');
            li.append(`ID: ${student.id}, Имя: ${student.firstName}, Фамилия: ${student.lastName}, Отчество: ${student.middleName}, Дата рождения: ${formatDate(student.birthDate)}, Группа: ${student.groupNumber}, Уникальный номер: ${student.uniqueNumber}`);
            let button = $("<button>");
            button.text('Удалить');
            button.attr('onclick', `deleteStudent(${student.uniqueNumber})`);
            li.append(button);
            $('#students-list ul').append(li);
        });
    }).fail(function (jqXHR, textStatus, errorThrown) {
        alert('Ошибка при загрузке списка студентов: ' + textStatus);
    });
}

$('#add-student-form form').submit(function (event) {
    event.preventDefault();
    let student = {
        firstName: $('#first-name').val(),
        lastName: $('#last-name').val(),
        middleName: $('#middle-name').val(),
        birthDate: $('#birth-date').val().split('-'),
        groupNumber: $('#group-number').val(),
        uniqueNumber: $('#unique-number').val()
    };

    $.ajax({
        url: '/api/students',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(student),
        success: function () {
            loadStudents();
            $('#add-student-form input').val('');
        },
        error: function (jqXHR, status, error) {
            alert('Не удалось добавить студента: ' + status);
        }
    });
});

function deleteStudent(uniqueNumber) {
    if (confirm('Вы уверены, что хотите удалить этого студента?')) {
        $.ajax({
            url: `/api/students/${uniqueNumber}`,
            method: 'DELETE',
            success: function () {
                loadStudents();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('Произошла ошибка при удалении студента: ' + textStatus + ', ' + errorThrown);
            }
        });
    }
}

// Функция форматирования даты
function formatDate(date) {
    var d = new Date(date),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();

    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;

    return [year, month, day].join('-');
}
</script>
</body>
</html>